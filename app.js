# full app.js code omitted here for brevity, identical to previous detailed version